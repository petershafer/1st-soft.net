"use strict";angular.module("angularClpApp",[]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/photo/:photo/",{templateUrl:"views/photo.html",controller:"PhotoCtrl"}).when("/page/:page/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tag/:tag/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/tag/:tag/page/:page/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about/",{templateUrl:"views/about.html",controller:"MiscCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("angularClpApp").controller("MainCtrl",["$scope","$routeParams","Database",function(a,b,c){a.total=0,a.current_page=parseInt(b.page)||1,a.tag=b.tag||"",a.pageSize=18,a.saved_items=c.saved_items,a.loaded=!1;var d=""==a.tag?"photo":"tag",e=""==a.tag?"":"key="+encodeURIComponent('"'+a.tag+'"')+"&";if(a.page_url=""==a.tag?"/":"/tag/"+a.tag+"/",a.open=function(b){a.current_image="http://cloudant.com/db/1st-soft/clp_gallery/"+b.id+"/full.jpg",a.current_photo=b},a.encode=function(a){return encodeURIComponent(a)},a.toggleSaved=function(a){c.saved_items[a.id]?delete c.saved_items[a.id]:c.saved_items[a.id]=a,c.update_saved_items()},a.is_saved=function(a){return a?c.saved_items[a.id]:void 0},0==c.saved_items&&c.load_saved_items(),"Saved"!=a.tag)c.jsonp({url:"http://cloudant.com/db/1st-soft/clp_gallery/_design/filters/_view/"+d+"?"+e+"skip="+(a.current_page-1)*a.pageSize+"&limit="+a.pageSize+"&descending=true",cache:!0}).then(function(b){console.log(b),a.awesomeThings=b.rows,a.loaded=!0}),c.jsonp({url:"http://cloudant.com/db/1st-soft/clp_gallery/_design/filters/_view/"+d+"_count?"+e+"group=true&group_level=1",cache:!0}).then(function(b){console.log(b),b.rows.length&&(a.total=b.rows[0].value,a.last_page=Math.ceil(a.total/a.pageSize),a.pages=_.range(Math.max(a.current_page-3,1),Math.min(a.current_page+3,a.last_page+1)))});else{var f=(a.current_page-1)*a.pageSize;a.awesomeThings=_.values(c.saved_items).slice(f,f+a.pageSize),a.loaded=!0,a.total=_.keys(c.saved_items).length,a.last_page=Math.ceil(a.total/a.pageSize),a.pages=_.range(Math.max(a.current_page-3,1),Math.min(a.current_page+3,a.last_page+1))}a.page=document.location.href}]),angular.module("angularClpApp").service("Database",["$http","$q",function(a,b){var c={url:"",saved_items:!1,total_saved_items:0,total_callback:null,update_saved_items:function(){localStorage.saved_items=JSON.stringify(this.saved_items),this.total_saved_items=_.keys(this.saved_items).length,null!=this.total_callback&&this.total_callback(this.total_saved_items)},load_saved_items:function(){this.saved_items="undefined"!=typeof localStorage.saved_items?$.parseJSON(localStorage.saved_items):{},this.total_saved_items=_.keys(this.saved_items).length,null!=this.total_callback&&this.total_callback(this.total_saved_items)},jsonp:function(c){c=c||{};var d="?";-1!=c.url.indexOf("?")&&(d="&"),c.url+=d+"callback=JSON_CALLBACK";var e=b.defer(),f=c.url||this.url,g=c.method||"GET",h=c.params||{},i=c.data||{};return a.jsonp(f,{method:g.toUpperCase(),params:h,data:i}).success(_.bind(function(a,b){e.resolve(a,b)},this)).error(_.bind(function(a,b,c,d){console.log("error syncing with: "+f),a.status=b,e.reject(a,b,c,d)},this)),e.promise}};return c}]),angular.module("angularClpApp").service("Generic",function(){}),angular.module("angularClpApp").controller("NavigationCtrl",["$scope","$routeParams","Database",function(a,b,c){a.params=b,a.total_saved=0,a.update_total=function(b){a.total_saved=b},c.total_callback=a.update_total,a.encode=function(a){return encodeURIComponent(a)},c.jsonp({url:"http://cloudant.com/db/1st-soft/clp_gallery/_design/filters/_view/tag_count?group=true&group_level=1",cache:!0}).then(function(b){a.tags=b.rows})}]),angular.module("angularClpApp").controller("PhotoCtrl",["$scope","$routeParams","$location","Database",function(a,b,c,d){a.id=b.photo,0==d.saved_items&&d.load_saved_items(),d.jsonp({url:"http://cloudant.com/db/1st-soft/clp_gallery/"+a.id+"/",cache:!0}).then(function(b){console.log(b),a.current_photo=b,a.url="http://cloudant.com/db/1st-soft/clp_gallery/"+a.id+"/full.jpg"}),a.encode=function(a){return encodeURIComponent(a)},a.toggleSaved=function(a){console.log("-=-=-=-="),console.log(a),d.saved_items[a._id]?delete d.saved_items[a._id]:d.saved_items[a._id]={id:a._id,value:a},d.update_saved_items()},a.is_saved=function(a){return a?d.saved_items[a._id]:void 0},a.page=document.location.href}]),angular.module("angularClpApp").controller("MiscCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);